<div class="market-data-dashboard">
  <h2>Stock Market Dashboard</h2>

  <!-- Search Controls -->
  <div class="search-form">
    <input
      [(ngModel)]="ticker"
      placeholder="Ticker (e.g., AAPL)"
      (keyup.enter)="fetchData()"
    />
    <input [(ngModel)]="fromDate" type="date" />
    <input [(ngModel)]="toDate" type="date" />
    <select [(ngModel)]="timespan">
      <option value="day">Daily</option>
      <option value="hour">Hourly</option>
      <option value="week">Weekly</option>
      <option value="month">Monthly</option>
    </select>
    <button (click)="fetchData()" [disabled]="loading">
      {{ loading ? 'Loading...' : 'Fetch Data' }}
    </button>
  </div>

  <!-- Error -->
  @if (error) {
    <div class="error-message">{{ error }}</div>
  }

  <!-- Loading -->
  @if (loading) {
    <div class="loading">Fetching data for {{ ticker }}...</div>
  }

  <!-- Dashboard Content -->
  @if (aggregates.length > 0 && !loading) {
    <div class="dashboard-content">
      <h3>{{ ticker }} &mdash; {{ aggregates.length }} bars</h3>

      <!-- Summary Stats -->
      <app-summary-stats [summary]="summary"></app-summary-stats>

      <!-- Candlestick Chart -->
      <div class="chart-section">
        <h4>Candlestick Chart (OHLC)</h4>
        <app-candlestick-chart [data]="aggregates" [ticker]="ticker"></app-candlestick-chart>
      </div>

      <!-- Volume Chart -->
      <div class="chart-section">
        <h4>Volume</h4>
        <app-volume-chart [data]="aggregates"></app-volume-chart>
      </div>

      <!-- Line Chart -->
      <div class="chart-section">
        <h4>Closing Prices</h4>
        <app-line-chart [data]="aggregates" [ticker]="ticker"></app-line-chart>
      </div>

      <!-- Data Table (collapsed by default) -->
      <details class="data-table-section">
        <summary>View Raw Data Table ({{ aggregates.length }} rows)</summary>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Open</th>
              <th>High</th>
              <th>Low</th>
              <th>Close</th>
              <th>Volume</th>
              <th>VWAP</th>
            </tr>
          </thead>
          <tbody>
            @for (bar of aggregates; track bar.id) {
              <tr>
                <td>{{ bar.timestamp | date:'yyyy-MM-dd' }}</td>
                <td>{{ bar.open | number:'1.2-2' }}</td>
                <td>{{ bar.high | number:'1.2-2' }}</td>
                <td>{{ bar.low | number:'1.2-2' }}</td>
                <td>{{ bar.close | number:'1.2-2' }}</td>
                <td>{{ bar.volume | number:'1.0-0' }}</td>
                <td>{{ bar.volumeWeightedAveragePrice | number:'1.2-2' }}</td>
              </tr>
            }
          </tbody>
        </table>
      </details>
    </div>
  }
</div>
